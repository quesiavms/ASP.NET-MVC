@{
    ViewBag.Title = "DeleteEmployee";
    Layout = null;
}

@model IEnumerable<MVCTutorial.Models.EmployeeViewModel>

<link href="/lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.0/js/bootstrap.bundle.min.js"></script>

<style>
    body {
        background-color: #f4f6f9;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: flex-start;
    }

    .container {
        width: 40%;
        margin-top: 20px;
    }

    #loaderDiv {
        display: none;
    }
</style>

<div class="container" style="width: 40%; margin-top:2%">

    <table class="table table-responsive">
        <tr>
            <th>Name</th>
            <th>Department</th>
            <th>Addres</th>
            <th></th>
        </tr>
        <tbody>
            @if(ViewBag.EmployeeList != null){
                foreach(var item in ViewBag.EmployeeList){
                    <tr id="row_@item.EmployeeID">
                        <td>@item.Name</td>
                        <td>@item.DepartmentName</td>
                        <td>@item.Address</td>
                        <td><a href="#" class="btn btn-danger" onclick="ConfirmDelete(@item.EmployeeID)"><i class="glyphicon glyphicon-trash"></i> </a> </td>
                    </tr>
                }
            }
        </tbody>
    </table>

    <input type="hidden" id="hiddenEmployeeID"/>

    <div class="modal fade" id="myModal" ">
        <div class="modal-dialog" ">
            <div class="modal-content">

                <div class="modal-header">
                    <a href="#" class="close" data-dismiss="modal">&times;</a>
                    <h4 class="modal-title">Delete Employee</h4>
                </div>

                <div class="modal-body">
                    <h5>Are you sure you want to delete this employee?</h5>

                    <div style="text-align:center;" id="loaderDiv">
                        <img src="/Contents/InternetSlowdown_Day.gif" class="img-fluid" style="max-width: 20%;" />
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <a href="#" class="btn btn-success" onclick="DeleteEmployee()">Confirm</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    var ConfirmDelete = function(EmployeeID){
        $("#hiddenEmployeeID").val(EmployeeID);
        $("#myModal").modal("show");
    };

    // $(document).ready(function() {

        var DeleteEmployee = function(){
            $("#loaderDiv").show();

            var empID = $("#hiddenEmployeeID").val();

            $.ajax({
                type: "POST",
                url: "/Teste/DeleteEmployee", 
                data: { EmployeeID: empID },
                success: function(result) {
                    $("#loaderDiv").hide();
                    $("#myModal").modal("hide");
                    $("#row_"+ empID).remove();
                    alert("Employee deleted successfully!");
            }
        });
    }
// });
</script>

